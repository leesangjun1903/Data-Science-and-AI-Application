# Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation

### 1. 핵심 주장과 주요 기여 (요약)

이 논문의 핵심 주장은 **블랙박스 머신러닝 모델의 해석 가능성 문제를 시각화 도구로 해결**하는 것입니다. 저자들은 기존 Partial Dependence Plot (PDP)이 특성(feature)과 예측값 간의 **평균 관계**만을 보여주기 때문에, 상호작용 효과(interaction effects)가 있을 때 실제 모델의 복잡성을 은폐할 수 있다고 지적합니다.[1]

이를 해결하기 위해 **Individual Conditional Expectation (ICE) plots**이라는 새로운 시각화 방법을 제안합니다. ICE 플롯은 각 관측값에 대해 특정 특성이 예측값에 미치는 함수 관계를 개별적으로 표시하여, PDP가 놓칠 수 있는 **이질성(heterogeneity)과 상호작용을 가시화**합니다.[1]

**주요 기여:**
- 모델에 독립적인 범용 시각화 도구(algorithm-agnostic) 개발
- Centered ICE (c-ICE)와 Derivative ICE (d-ICE) 등 보완적 시각화 기법 제안
- 상호작용 검출 및 외삽(extrapolation) 영역 식별 가능
- 데이터의 가법성(additivity) 검증을 위한 통계적 시각 검정 방법 제공

***

### 2. 문제 정의, 방법론, 모델 구조, 성능 및 한계

#### 2.1 해결하고자 하는 문제

블랙박스 머신러닝 알고리즘들(Random Forest, Gradient Boosting, Neural Networks 등)은 낮은 일반화 오류를 달성하지만, **모델이 특성을 어떻게 사용하여 예측을 생성하는지 이해하기 어렵다는 문제**가 있습니다.[1]

특히 기존 PDP는 다음의 한계를 가집니다:[1]
- 평균화로 인한 이질성 은폐
- 상호작용 효과 감지 불가
- 데이터 없는 영역의 외삽 특성 파악 어려움

#### 2.2 수학적 방법론

**Partial Dependence 함수 (기존):**

$$f_S = E_{x_C}[f(x_S, x_C)] = \int f(x_S, x_C) dP(x_C)$$

추정: $$\hat{f}\_S = \frac{1}{N}\sum_{i=1}^{N}\hat{f}(x_S, x_{C_i})$$[1]

**Individual Conditional Expectation (제안):**

각 관측값 $$i$$에 대해 조건부 고정 $$x_{C_i}$$에서 $$x_S$$ 변화에 따른 곡선을 개별 플롯합니다. 즉, $$N$$개의 곡선 $$\{\hat{f}^{(i)}\_S\}_{i=1}^{N}$$을 시각화하며, 이들의 평균이 PDP와 일치합니다.[1]

**Centered ICE (c-ICE):**

$$\hat{f}^{(i)}\_{\text{cent}} = \hat{f}^{(i)} - \mathbf{1}\hat{f}(x^*, x_{C_i})$$[1]

기준점 $$x^*$$에서 모든 곡선을 고정하여 수준 효과를 제거하고 순수한 누적 효과를 드러냅니다.

**Derivative ICE (d-ICE):**

$$\frac{\partial\hat{f}(x)}{\partial x_S} = g'(x_S)$$ (가법성 가정)[1]

수치 미분을 사용하여 편미분값을 직접 플롯하면, 상호작용 부재 시 모든 곡선이 동일하고, 상호작용 존재 시 곡선들이 이질성을 보입니다.

#### 2.3 알고리즘 구조

**ICE 알고리즘:**

1. 고정 $$x_{C_i}$$: 각 관측값 $$i$$의 조건부 특성 고정
2. 변동 $$x_S$$: 훈련 데이터에서 관찰된 $$x_S$$ 값들을 순회
3. 예측값 계산: $$\hat{f}^{(i)}\_{S_\ell} = \hat{f}([x_{S_\ell}, x_{C_i}])$$
4. 곡선 시각화: $$N$$개의 조건부 곡선 표시[1]

**일반화를 위한 알고리즘 2 (d-ICE):**

1. 각 ICE 곡선을 "supersmoother"로 평탄화
2. 평탄화된 곡선에서 수치 미분 계산
3. 도함수 플롯 및 표준편차 계산

#### 2.4 모델 성능 향상

논문에서 제시하는 성능 향상은 직접적인 예측 정확도 개선이 아니라, **모델 해석성 향상**에 중점을 두고 있습니다:[1]

- **상호작용 검출**: 시뮬레이션에서 PDP가 관계를 은폐할 때 ICE 플롯이 명확하게 드러냄
- **실제 데이터 예시**:
  - **우울증 임상 시험**: BART 모델의 평탄한 PDP 뒤에 $$\pm 3$$점 범위의 치료 효과 상호작용 발견 (응답 범위의 ~20%)
  - **백포도주 데이터**: 신경망에서 pH와 알코올 함량의 상호작용 검출, 누적 효과가 응답 범위의 40%
  - **Pima Indians 당뇨병**: 피부 두께와 연령의 상호작용 식별

#### 2.5 한계

1. **계산 복잡도**: $$N$$개의 곡선 생성으로 인한 시각적 과다 정보(overplotting) - 부분 플롯으로 완화 가능

2. **고차원 문제**: 2차원 이상의 특성 간 상호작용 시각화의 어려움 (색상 오버로딩으로 부분적 해결)

3. **외삽 의존성**: 데이터 없는 영역에서의 곡선 해석의 어려움 - 관찰 위치 표시로 완화

4. **가법성 검정의 한계**: Section 6의 시각 검정은 backfitting과 특정 학습 알고리즘 선택에 의존하며, $$\alpha = 1/K$$의 제약이 있음

5. **모델 비교의 복잡성**: 다양한 알고리즘 간 상세한 비교는 수동적 해석 필요

---

### 3. 모델 일반화 성능과 관련된 내용

#### 3.1 일반화 성능 향상의 진단적 역할

ICE 플롯은 다음 메커니즘을 통해 **모델 일반화 성능 평가 및 개선**에 기여합니다:[1]

**상호작용 구조 파악:**
- 곡선의 병렬성 여부로 가법성 평가
- 비병렬 곡선은 학습된 상호작용 구조 의존성 나타냄
- 이는 새로운 데이터에 일반화되는 실제 신호vs 과적합 구분에 도움

**외삽 영역 식별:**
- 훈련 데이터 위치 표시로 데이터 희소 영역에서의 모델 행동 파악
- 예: 랜덤 포레스트의 다항식 외삽 패턴 시각화 (Figure 9)
- 테스트 시간의 분포 이동 문제 사전 감지 가능

#### 3.2 실제 적용: 당뇨병 분류 (Pima Indians)

선형 모델 가정이 깨질 때 ICE의 중요성:[1]
- 피부 두께(skin) 특성의 c-ICE 플롯에서 d-ICE 표준편차 피크가 skin ≈ 30에서 나타남
- 이는 **모델이 학습한 이질적 관계**를 나타냄
- 그래프의 상단 곡선(연령이 높은 대상)은 외삽 특성으로 표시 - 새 데이터 적용 시 신뢰도 낮음

#### 3.3 가법성 테스트와 일반화

**Section 6의 시각 검정 방법:**[1]

1. Backfitting으로 $$g^\*(x_S), h^\*(x_C)$$의 가법성 추정
2. Residuals 부트스트래핑으로 귀무가설 데이터 생성
3. 동일 알고리즘으로 재학습하여 null ICE 플롯 생성
4. 실제 플롯이 $$K-1$$개 null 플롯 사이에서 식별되면 $$\alpha = 1/K$$ 유의수준에서 상호작용 존재 확인

**와인 데이터 예시:**
- pH와 다른 특성의 상호작용: 약한 증거 (비교적 구분 어려움)
- 이는 일반화 시 상호작용 구조의 불안정성 시사 가능

#### 3.4 모델 선택에 대한 함의

- 같은 데이터에 여러 알고리즘 적용 후 ICE 비교 → 안정적 패턴을 보이는 모델 선택 → 일반화 성능 개선 가능성

***

### 4. 앞으로의 연구에 미치는 영향 및 고려 사항

#### 4.1 학술적 영향

**즉각적 영향:**
- **XAI(Explainable AI) 분야의 토대**: 이후 SHAP, LIME 등 현대적 해석성 도구의 선구자 역할
- **모델-비의존적 접근**: 머신러닝의 어느 알고리즘에도 적용 가능한 보편적 방법론 제시
- **상호작용 분석 표준화**: 기존 domain-specific 방법을 통합적 프레임워크로 통합

**후속 연구 확대:**
- 고차원 특성 간 상호작용 시각화 기술 발전
- 자동화된 상호작용 탐지 알고리즘 개발

#### 4.2 실무 적용 시 고려 사항

**1. 해석 시 주의:**
- **곡선 간 패턴 vs 노이즈 구분**: Section 6의 통계적 검정 필수
- **외삽과 보간 구분**: 관찰점 표시의 중요성
- **색상 오버로딩 한계**: 2개 특성 이상의 상호작용은 제한적

**2. 계산 최적화:**
- 대규모 데이터셋($$N > 10,000$$)에서 곡선 부분 샘플링 권장
- GPU 기반 배치 예측으로 계산 속도 개선 가능

**3. 도메인 지식 통합:**
- ICE 플롯의 이질성이 실제 물리적/생물학적 의미를 가지는지 검증 필수
- 임상 시험 데이터: 발견된 상호작용이 통계적으로 유의한지 별도 검정 필요

**4. 다중 비교 문제:**
- 여러 특성에 대해 ICE 플롯 생성 시 거짓 양성(false positive) 가능
- Bonferroni 보정이나 다중 검정 절차 권장

#### 4.3 앞으로의 연구 방향

**단기 (향후 5년):**
- 고차원 데이터의 interactive visualization 개발
- 자동화된 상호작용 패턴 인식(clustering) 알고리즘
- 실시간 모델 모니터링 시스템 구축

**장기 (향후 5-10년):**
- **의료 AI 규제 준수**: FDA 승인 모델의 필수 해석성 도구로 ICE 표준화
- **인공지능 윤리**: 모델 편향 검출 및 공정성 평가의 수단으로 활용
- **강화학습 해석**: 정책 함수의 상태-행동 상호작용 분석

#### 4.4 논문의 한계 극복 방안

**현재 연구의 제약:**

| 한계 | 개선 방향 |
|------|---------|
| 2D 이상 상호작용 시각화 어려움 | 3D 플롯, 평행 좌표계(parallel coordinates), 인터랙티브 시각화 |
| 계산 복잡도 $$O(N^2)$$ | 그래프 뉴럴 네트워크 기반 가속화, 근사 알고리즘 |
| Backfitting 기반 가법성 검정의 모델 의존성 | 모델-비의존적 가법성 검정 방법 개발 |
| 정적 시각화 | 동적/인터랙티브 대시보드 시스템 구현 |

***

### 결론

이 논문은 **블랙박스 모델의 해석 가능성 문제를 실용적이고 통계적으로 엄밀한 방식**으로 해결한 중요한 기여를 제시합니다. ICE 플롯의 보편성과 직관성은 이후 XAI 연구의 새로운 패러다임을 열었으며, 특히 의료, 금융, 사법 영역에서 모델 설명성의 필수 요소로 자리잡았습니다.[1]

앞으로의 연구에서는 **고차원 시각화, 자동화된 패턴 인식, 인터랙티브 시스템** 개발이 중점이 될 것으로 예상되며, ICE 프레임워크의 수학적 엄밀성을 유지하면서 실무 적용성을 높이는 방향으로 진화할 것입니다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/50926bcb-2ae7-483d-bb73-ab39f1dfb382/1309.6392v2.pdf)
